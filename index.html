<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÿØÿ±ÿØÿ¥ÿ© AI</title>
<style>
* { box-sizing: border-box; }
body { margin: 0; font-family: Arial, sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; }

#chat { width: 100%; max-width: 450px; height: 100%; max-height: 700px; border: 1px solid #ddd; border-radius: 15px; background: #fff; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }

#messages { flex: 1; padding: 10px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; scroll-behavior: smooth; }

.message { display: flex; max-width: 80%; padding: 8px 12px; border-radius: 20px; position: relative; word-wrap: break-word; opacity: 0; transform: translateY(20px); animation: slideIn 0.3s forwards; }
.user { background: #dcf8c6; align-self: flex-end; border-bottom-right-radius: 0; flex-direction: row-reverse; }
.bot { background: #007bff; color: #fff; align-self: flex-start; border-bottom-left-radius: 0; }

.avatar { width: 32px; height: 32px; border-radius: 50%; margin: 0 8px; }
.content { display: flex; flex-direction: column; }
.text { margin-bottom: 4px; word-break: break-word; }
.time { font-size: 10px; color: #555; align-self: flex-end; }
.message img { max-width: 200px; border-radius: 10px; margin-top: 5px; }

#inputArea { display: flex; padding: 10px; border-top: 1px solid #ddd; background: #f1f1f1; }
#inputArea input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ccc; outline: none; }
#inputArea button { margin-left: 5px; padding: 10px 15px; border: none; border-radius: 20px; background: #0095f6; color: #fff; cursor: pointer; }
#inputArea label { margin-left:5px; cursor: pointer; }
#fileInput { display:none; }

@keyframes slideIn { to { opacity: 1; transform: translateY(0); } }

@media screen and (max-width: 500px) {
  #chat { max-width: 100%; height: 100%; border-radius: 0; }
}
</style>
</head>
<body>
<div id="chat">
  <div id="messages"></div>
  <div id="inputArea">
    <input id="input" type="text" placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ™ŸÉ...">
    <label for="fileInput">üìé</label>
    <input type="file" id="fileInput">
    <button onclick="sendMessage()">ÿ•ÿ±ÿ≥ÿßŸÑ</button>
  </div>
</div>

<script>
const userAvatar = "https://i.pravatar.cc/32?img=3";
const botAvatar = "https://i.pravatar.cc/32?img=12";

function formatTime() {
  const now = new Date();
  return now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
}

function notifyUser(text) {
  if (document.hidden) {
    new Notification("ÿ±ÿ≥ÿßŸÑÿ© ÿ¨ÿØŸäÿØÿ© ŸÖŸÜ ÿßŸÑÿ®Ÿàÿ™", { body: text });
  }
}

async function sendMessage() {
  const input = document.getElementById("input");
  const messages = document.getElementById("messages");
  const fileInput = document.getElementById("fileInput");

  if (input.value.trim() === "" && fileInput.files.length === 0) return;

  let userContent = input.value;

  const userMsg = document.createElement("div");
  userMsg.className = "message user";
  userMsg.innerHTML = `
    <img class="avatar" src="${userAvatar}" alt="user">
    <div class="content">
      <div class="text">${userContent}</div>
      ${fileInput.files[0] ? `<img src="${URL.createObjectURL(fileInput.files[0])}">` : ""}
      <div class="time">${formatTime()}</div>
    </div>
  `;
  messages.appendChild(userMsg);
  messages.scrollTop = messages.scrollHeight;

  const formData = { message: userContent };
  try {
    const response = await fetch("/chat", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(formData)
    });
    const data = await response.json();

    const botMsg = document.createElement("div");
    botMsg.className = "message bot";
    botMsg.innerHTML = `
      <img class="avatar" src="${botAvatar}" alt="bot">
      <div class="content">
        <div class="text">${data.reply}</div>
        <div class="time">${formatTime()}</div>
      </div>
    `;
    messages.appendChild(botMsg);
    messages.scrollTop = messages.scrollHeight;

    notifyUser(data.reply);

  } catch (err) {
    console.error(err);
    alert("‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ≥Ÿäÿ±ŸÅÿ±");
  }

  input.value = "";
  fileInput.value = "";
  input.focus();
}

if (Notification.permission !== "granted") {
  Notification.requestPermission();
}
</script>
</body>
</html>
